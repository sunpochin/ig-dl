<template>
  <!-- ‰∏ªÂÆπÂô®: ‰ΩøÁî®Êº∏Â±§ËÉåÊôØÔºåÂÖ®Â±èÈ´òÂ∫¶Ôºå‰ΩøÁî® flexbox ÁΩÆ‰∏≠ -->
  <div class="min-h-screen bg-gradient-to-br from-purple-500 via-purple-600 to-pink-500 flex items-center justify-center p-4">
    <!-- Âç°ÁâáÂÆπÂô®: ‰ΩøÁî®Êõ¥ÂØ¨ÁöÑÊúÄÂ§ßÂØ¨Â∫¶ÊàñÂÆåÂÖ®ÁßªÈô§ÈôêÂà∂ -->
    <div class="w-full max-w-7xl">
      <!-- ‰∏ªÂç°Áâá: ÁôΩËâ≤ËÉåÊôØÔºå‰ΩøÁî® flex ‰æÜÁΩÆ‰∏≠ÂÖßÂÆπ -->
      <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 lg:p-16 flex flex-col">
        <!-- Ê®ôÈ°åÂçÄÂ°ä: ‰ΩøÁî® flex Á¢∫‰øùÂ±Ö‰∏≠Â∞çÈΩä -->
        <div class="w-full flex flex-col items-center mb-12">
          <h1 class="text-5xl font-bold text-gray-800 mb-4 text-center">Instagram ‰∏ãËºâÂô®</h1>
          <p class="text-lg text-gray-600 text-center mb-6">‰∏ãËºâ Instagram Reels Âíå Stories</p>
          
        </div>

        <!-- Ê®°ÂºèÂàáÊèõÊåâÈàï -->
        <div class="w-full mb-8 flex justify-center">
          <div class="flex bg-gray-100 rounded-xl p-1">
            <button
              @click="mode = 'reel'"
              :class="[
                'px-6 py-3 rounded-lg font-medium transition-all',
                mode === 'reel' 
                  ? 'bg-white text-purple-600 shadow-md' 
                  : 'text-gray-600 hover:text-gray-800'
              ]"
            >
              üìπ Reel ‰∏ãËºâ
            </button>
            <button
              @click="mode = 'story'"
              :class="[
                'px-6 py-3 rounded-lg font-medium transition-all',
                mode === 'story' 
                  ? 'bg-white text-purple-600 shadow-md' 
                  : 'text-gray-600 hover:text-gray-800'
              ]"
            >
              üì± Story ‰∏ãËºâ
            </button>
            <button
              @click="mode = 'batch-stories'"
              :class="[
                'px-6 py-3 rounded-lg font-medium transition-all',
                mode === 'batch-stories' 
                  ? 'bg-white text-purple-600 shadow-md' 
                  : 'text-gray-600 hover:text-gray-800'
              ]"
            >
              üìö ÊâπÈáè Stories
            </button>
          </div>
        </div>

        <!-- Ëº∏ÂÖ•ÂçÄÂ°ä: ÁßªÈô§ÂØ¨Â∫¶ÈôêÂà∂Ôºå‰ΩøÁî®ÂÖ®ÂØ¨ -->
        <div class="w-full space-y-6">
          <!-- URL Ëº∏ÂÖ•Ê°Ü: ÂÖ®ÂØ¨ÔºåÊñáÂ≠óÁΩÆ‰∏≠ -->
          <div class="w-full">
            <input
              v-model="inputUrl"
              type="text"
              :placeholder="getPlaceholderText()"
              class="w-full px-6 py-4 text-lg text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:border-purple-500 transition-colors placeholder:text-center"
              @keyup.enter="handleAction()"
            />
          </div>

          <!-- Êìç‰ΩúÊåâÈàï: Ê†πÊìöÊ®°ÂºèÈ°ØÁ§∫‰∏çÂêåÊåâÈàï -->
          <button
            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-4 px-8 text-lg rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl"
            :disabled="loading || !inputUrl"
            @click="handleAction()"
          >
            <!-- Ê≠£Â∏∏ÁãÄÊÖãÊñáÂ≠ó -->
            <span v-if="!loading">{{ getButtonText() }}</span>
            <!-- ËºâÂÖ•‰∏≠ÁãÄÊÖã: È°ØÁ§∫ÊóãËΩâÂãïÁï´ÂíåÊñáÂ≠ó -->
            <span v-else class="flex items-center justify-center">
              <!-- SVG ËºâÂÖ•ÂãïÁï´ÂúñÊ®ô -->
              <svg class="animate-spin h-6 w-6 mr-3" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              {{ getLoadingText() }}
            </span>
          </button>
        </div>

        <!-- ÈåØË™§Ë®äÊÅØÂçÄÂ°ä: ‰ΩøÁî®ÂÖ®ÂØ¨ -->
        <div v-if="error" class="w-full mt-6">
          <div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-xl text-center">
            {{ error }}
          </div>
        </div>

        <!-- Stories Ê∏ÖÂñÆÈ°ØÁ§∫ÂçÄÂ°ä -->
        <div v-if="storiesList.length > 0" class="w-full mt-8">
          <div class="p-6 bg-blue-50 border border-blue-300 rounded-xl">
            <h3 class="text-blue-800 font-semibold mb-4 text-lg text-center">ÊâæÂà∞ {{ storiesList.length }} ÂÄã Stories</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
              <div 
                v-for="story in storiesList" 
                :key="story.id"
                class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow cursor-pointer"
                @click="downloadSpecificStory(story.url)"
              >
                <!-- Á∏ÆÂúñ -->
                <div class="aspect-square bg-gray-200 rounded-lg mb-3 overflow-hidden">
                  <img 
                    v-if="story.thumbnail" 
                    :src="story.thumbnail" 
                    :alt="story.title || 'Story'"
                    class="w-full h-full object-cover"
                    @error="$event.target.style.display = 'none'"
                  />
                  <div v-else class="w-full h-full flex items-center justify-center text-gray-400">
                    <svg class="w-12 h-12" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                    </svg>
                  </div>
                </div>
                
                <!-- Ê®ôÈ°å/ÊôÇÈñì -->
                <p class="text-sm text-gray-700 line-clamp-2 mb-2">
                  {{ story.title || story.timestamp || 'ÈªûÊìä‰∏ãËºâ Story' }}
                </p>
                
                <!-- Story È°ûÂûãÊ®ôÁ±§ -->
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs bg-purple-100 text-purple-600 px-2 py-1 rounded">
                    {{ story.media_type === 'video' ? 'ÂΩ±Áâá' : 'ÂúñÁâá' }}
                  </span>
                  <span v-if="story.duration" class="text-xs text-gray-500">
                    {{ story.duration }}s
                  </span>
                </div>
                
                <!-- ‰∏ãËºâÊåâÈàï -->
                <button class="w-full bg-purple-600 text-white py-2 px-3 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                  ‰∏ãËºâÊ≠§ Story
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Reel/Story È†êË¶ΩÂíå‰∏ãËºâÂçÄÂ°ä -->
        <!-- 
          üé¨ È†êË¶ΩÂäüËÉΩË™™ÊòéÔºö
          ÈÄôÂÄãÂçÄÂ°äÂ∞±ÂÉè SnapInsta ÁöÑÈ†êË¶ΩÂäüËÉΩ‰∏ÄÊ®£ÔºÅ
          1. Ë¶ñÈ†ªÈ†êË¶Ω - Âú®ÈªëËâ≤Ê°ÜÊ°ÜË£°Êí≠ÊîæÂΩ±ÁâáÔºàÂ∞±ÂÉèÁ∂≤È†Å‰∏äÁöÑÂ∞èÈõªË¶ñÔºâ
          2. ÊéßÂà∂ÊåâÈàï - ÂèØ‰ª•Êí≠Êîæ„ÄÅÊö´ÂÅú„ÄÅË™øÈü≥ÈáèÔºàÂ∞±ÂÉèÈÅôÊéßÂô®Ôºâ
          3. ‰∏ãËºâÊåâÈàï - Èªû‰∏Ä‰∏ãÂ∞±Áõ¥Êé•‰∏ãËºâÂà∞ÈõªËÖ¶Ôºà‰∏çÁî®ÈñãÊñ∞ÂàÜÈ†ÅÔºâ
        -->
        <div v-if="videoUrl && (mode === 'reel' || mode === 'story')" class="w-full mt-8">
          <div class="p-6 bg-green-50 border border-green-300 rounded-xl">
            <p class="text-green-800 font-semibold mb-4 text-lg text-center">
              {{ mode === 'reel' ? 'Reel È†êË¶Ω' : 'Story È†êË¶Ω' }}
            </p>
            
            <!-- Ë¶ñÈ†ªÈ†êË¶ΩÂÆπÂô®ÔºàÂ∞±ÂÉèÁ∂≤È†Å‰∏äÁöÑÂ∞èÈõªË¶ñÔºâ -->
            <div class="bg-black rounded-lg overflow-hidden mb-4 max-w-md mx-auto">
              <video
                :src="videoUrl"
                controls
                preload="metadata"
                class="w-full h-auto max-h-96 object-contain"
                @loadedmetadata="onVideoLoaded"
                @error="onVideoError"
              >
                ÊÇ®ÁöÑÁÄèË¶ΩÂô®‰∏çÊîØÊåÅË¶ñÈ†ªÊí≠Êîæ
              </video>
            </div>
            
            <!-- ‰∏ãËºâÊåâÈàï -->
            <div class="flex flex-col sm:flex-row gap-3 justify-center items-center">
              <button
                @click="downloadVideo"
                :disabled="downloading"
                class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
              >
                <svg v-if="downloading" class="animate-spin h-5 w-5" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <svg v-else class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                {{ downloading ? '‰∏ãËºâ‰∏≠...' : '‰∏ãËºâË¶ñÈ†ª' }}
              </button>
              
              <!-- Ë¶ñÈ†ª‰ø°ÊÅØ -->
              <div v-if="videoInfo.duration" class="text-sm text-gray-600 text-center sm:text-left">
                <p>ÊôÇÈï∑: {{ formatDuration(videoInfo.duration) }}</p>
                <p v-if="videoInfo.size">Â§ßÂ∞è: {{ videoInfo.size }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ‰ΩøÁî®Ë™™ÊòéÂçÄÂ°ä: ‰ΩøÁî®ÂÖ®ÂØ¨Ôºå‰ΩøÁî® flex ÁΩÆ‰∏≠ -->
        <div class="w-full mt-12 pt-8 border-t border-gray-200 flex flex-col items-center">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">‰ΩøÁî®Ë™™Êòé</h2>
          
          <!-- Reel ‰∏ãËºâË™™Êòé -->
          <div v-if="mode === 'reel'" class="max-w-2xl">
            <h3 class="font-semibold text-gray-700 mb-3">Reel ‰∏ãËºâÔºö</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-600">
              <li>ÊâìÈñã InstagramÔºåÊâæÂà∞ÊÉ≥Ë¶Å‰∏ãËºâÁöÑ Reel</li>
              <li>ÈªûÊìäÂàÜ‰∫´ÊåâÈàï‰∏¶Ë§áË£Ω Reel ÈÄ£Áµê</li>
              <li>Â∞áÈÄ£ÁµêË≤ºÂà∞‰∏äÊñπËº∏ÂÖ•Ê°Ü</li>
              <li>ÈªûÊìä‰∏ãËºâÊåâÈàï</li>
            </ol>
            <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
              <p class="text-sm text-green-800">
                <strong>ÊîØÊè¥Ê†ºÂºèÔºö</strong>Reel ÈÄ£ÁµêÊ†ºÂºèÔºö<br>
                <code class="bg-green-100 px-1 rounded">https://www.instagram.com/reel/ABC123/</code><br>
                <code class="bg-green-100 px-1 rounded">https://www.instagram.com/p/ABC123/</code>
              </p>
            </div>
          </div>
          
          <!-- Story ‰∏ãËºâË™™Êòé -->
          <div v-else-if="mode === 'story'" class="max-w-2xl">
            <h3 class="font-semibold text-gray-700 mb-3">ÂñÆ‰∏Ä Story ‰∏ãËºâÔºö</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-600">
              <li>ÊâìÈñã InstagramÔºåÊâæÂà∞ÊÉ≥Ë¶Å‰∏ãËºâÁöÑ Story</li>
              <li>ÈªûÊìäÂàÜ‰∫´ÊåâÈàï‰∏¶Ë§áË£Ω Story ÈÄ£Áµê</li>
              <li>Â∞áÈÄ£ÁµêË≤ºÂà∞‰∏äÊñπËº∏ÂÖ•Ê°Ü</li>
              <li>ÈªûÊìä‰∏ãËºâÊåâÈàï</li>
            </ol>
            <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
              <p class="text-sm text-yellow-800">
                <strong>Ê≥®ÊÑèÔºö</strong>Stories ÈÄ£ÁµêÊ†ºÂºèÈÄöÂ∏∏ÁÇ∫Ôºö<br>
                <code class="bg-yellow-100 px-1 rounded">https://www.instagram.com/stories/username/story_id/</code>
              </p>
            </div>
            
            <!-- ÂØ¶È©óÊÄßÂäüËÉΩ -->
            <div class="mt-4 space-y-3">
              <!-- üéØ ÁúüÂØ¶ SnapIns.ai ÂÖãÈöÜÔºàÊúÄÊñ∞Á™ÅÁ†¥Ôºâ -->
              <div class="p-4 bg-gradient-to-r from-emerald-50 via-teal-50 to-cyan-50 border-3 border-emerald-400 rounded-xl shadow-xl">
                <h4 class="font-bold text-emerald-900 mb-2">üéØ ÁúüÂØ¶ SnapIns.ai ÂÖãÈöÜÔºàÁ™ÅÁ†¥ÊàêÂäüÔºÅÔºâ</h4>
                <label class="flex items-center text-sm text-emerald-800 mb-2 font-semibold">
                  <input 
                    type="checkbox" 
                    v-model="useSnapInsRealMethod"
                    class="mr-2"
                  >
                  ‰ΩøÁî®ÁúüÂØ¶ SnapIns.ai ÊäÄË°ìÔºàÁõ¥Êé•Ë™øÁî®‰ªñÂÄëÁöÑ action.phpÔºâ
                </label>
                <p class="text-xs text-emerald-700 font-medium">
                  ‚úÖ ÊàêÂäüÈÄÜÂêëÂ∑•Á®ã SnapIns.aiÔºÅÂÆåÁæéÊ®°‰ªø PHP ÂæåÁ´Ø + Ë°®ÂñÆÁ∑®Á¢ºË´ãÊ±Ç
                </p>
              </div>

              <!-- üèÜ ÁµÇÊ•µÊåëÊà∞ÊñπÊ≥ï -->
              <div class="p-3 bg-gradient-to-r from-purple-50 via-pink-50 to-red-50 border-2 border-purple-300 rounded-xl shadow-lg">
                <h4 class="font-bold text-purple-900 mb-2">üèÜ ÁµÇÊ•µÊåëÊà∞ÊñπÊ≥ïÔºàÊìäÊïó SnapInstaÔºâ</h4>
                <label class="flex items-center text-sm text-purple-800 mb-2 font-medium">
                  <input 
                    type="checkbox" 
                    v-model="useUltimateMethod"
                    class="mr-2"
                  >
                  ‰ΩøÁî®ÁµÇÊ•µÊñπÊ≥ïÊåëÊà∞ SnapInstaÔºàÂ≠∏Áøí‰ªñÂÄëÁöÑÁßòÂØÜÔºâ
                </label>
                <p class="text-xs text-purple-700">
                  üß† ÂçÅÊ≠≤Â≠©Á´•Ëß£Ë™™ÁâàÔºöÂ≠∏Áøí SnapInsta ÁúüÊ≠£ÁßòÂØÜ + ÂÆåÁæéÁÄèË¶ΩÂô®ÂÅΩÈÄ† + AI Ê∑±Â∫¶ÂàÜÊûê
                </p>
              </div>

              <!-- üöÄ Ë∂ÖÁ¥öÊô∫ËÉΩÊñπÊ≥ï -->
              <div class="p-3 bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg">
                <h4 class="font-semibold text-red-800 mb-2">üöÄ Ë∂ÖÁ¥öÊô∫ËÉΩÊñπÊ≥ïÔºàÊøÄÂ∞áÊ≥ïÁâπË£ΩÔºâ</h4>
                <label class="flex items-center text-sm text-red-700 mb-2">
                  <input 
                    type="checkbox" 
                    v-model="useUltraSmartMethod"
                    class="mr-2"
                  >
                  ‰ΩøÁî®Ë∂ÖÁ¥öÊô∫ËÉΩ‰∏ãËºâÔºà5 Á®ÆÊô∫ËÉΩÊñπÊ≥ïÁµÑÂêàÔºâ
                </label>
                <p class="text-xs text-red-600">
                  ‚ö° ÂÆåÁæéÊ®°Êì¨ÁúüÂØ¶ÁÄèË¶ΩÂô® + JSON ÊåñÊéò + Meta Ê®ôÁ±§Áçµ‰∫∫ + Ë∂ÖÁ¥ö CDN Êö¥ÂäõÁ†¥Ëß£
                </p>
              </div>

              <!-- SnapIns.ai È¢®Ê†ºÔºàÊúÄÊñ∞ÁôºÁèæÔºâ -->
              <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                <h4 class="font-semibold text-green-800 mb-2">üéØ SnapIns.ai È¢®Ê†ºÔºàÊúÄÊñ∞ÁôºÁèæÔºâ</h4>
                <label class="flex items-center text-sm text-green-700 mb-2">
                  <input 
                    type="checkbox" 
                    v-model="useSnapInsStyle"
                    class="mr-2"
                  >
                  ‰ΩøÁî® SnapIns.ai È¢®Ê†º‰∏ãËºâÔºàÂü∫ÊñºÊúÄÊñ∞Á†îÁ©∂Ôºâ
                </label>
                <p class="text-xs text-green-600">
                  üî¨ Âü∫ÊñºÂ∞ç https://snapins.ai/ ÁöÑÊäÄË°ìÂàÜÊûêÔºå‰ΩøÁî®ÂÖ¨ÈñãÁ´ØÈªûÂíåÂÖÉÊï∏ÊìöÊèêÂèñ
                </p>
              </div>

              <!-- SnapInsta È¢®Ê†º -->
              <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <h4 class="font-semibold text-blue-800 mb-2">üî• SnapInsta È¢®Ê†º</h4>
                <label class="flex items-center text-sm text-blue-700 mb-2">
                  <input 
                    type="checkbox" 
                    v-model="useSnapInstaStyle"
                    class="mr-2"
                  >
                  ‰ΩøÁî® SnapInsta È¢®Ê†º‰∏ãËºâÔºàCDN ÁåúÊ∏¨Ôºâ
                </label>
                <p class="text-xs text-blue-600">
                  üïµÔ∏è ÂòóË©¶Ê®°Êì¨ SnapInsta ÁöÑ CDN ÁÆóÊ≥ïÊé®Ê∏¨ÊñπÊ≥ï
                </p>
              </div>

              <!-- ÈÄ≤ÈöéÊñπÊ≥ï -->
              <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <h4 class="font-semibold text-red-800 mb-2">üß™ ÈÄ≤ÈöéÊñπÊ≥ï</h4>
                <label class="flex items-center text-sm text-red-700 mb-2">
                  <input 
                    type="checkbox" 
                    v-model="useAdvancedStory"
                    class="mr-2"
                  >
                  ‰ΩøÁî®ÈÄ≤Èöé Story ‰∏ãËºâÔºàÈúÄË¶Å CookieÔºâ
                </label>
                <div v-if="useAdvancedStory" class="mt-2">
                  <textarea
                    v-model="instagramCookie"
                    placeholder="ÂèØÈÅ∏ÔºöË≤º‰∏ä Instagram CookieÔºàÊ†ºÂºèÔºösessionid=...; csrftoken=...Ôºâ"
                    class="w-full p-2 text-xs border rounded resize-none"
                    rows="3"
                  ></textarea>
                  <p class="text-xs text-red-600 mt-1">
                    ‚ö†Ô∏è Ë≠¶ÂëäÔºö‰ΩøÁî® Cookie ÂèØËÉΩÈÅïÂèç Instagram ÊúçÂãôÊ¢ùÊ¨æÔºåÂÉÖ‰æõÊïôËÇ≤Á†îÁ©∂
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ÊâπÈáè Stories Ë™™Êòé -->
          <div v-else class="max-w-2xl">
            <h3 class="font-semibold text-gray-700 mb-3">ÊâπÈáè Stories ‰∏ãËºâÔºö</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-600">
              <li>ÊâìÈñã InstagramÔºåÊâæÂà∞ÁõÆÊ®ôÁî®Êà∂ÁöÑ Stories</li>
              <li>Ë§áË£Ω Stories ‰∏ªÈ†ÅÈÄ£ÁµêÔºà‰æãÂ¶ÇÔºöinstagram.com/stories/username/Ôºâ</li>
              <li>Â∞áÈÄ£ÁµêË≤ºÂà∞‰∏äÊñπËº∏ÂÖ•Ê°Ü</li>
              <li>ÈªûÊìäËß£ÊûêÊåâÈàïÔºåÁÄèË¶ΩË©≤Áî®Êà∂ÁöÑÊâÄÊúâ Stories</li>
              <li>ÈªûÊìä‰ªª‰∏Ä Story Âç°ÁâáÂç≥ÂèØ‰∏ãËºâ</li>
            </ol>
            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
              <p class="text-sm text-blue-800">
                <strong>ÊèêÁ§∫Ôºö</strong>Ê≠§ÂäüËÉΩÊúÉÂòóË©¶Áç≤ÂèñË©≤Áî®Êà∂Áï∂ÂâçÊâÄÊúâÂèØË¶ãÁöÑ StoriesÔºàÈÄöÂ∏∏Âú® 24 Â∞èÊôÇÂÖßÔºâ
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

// ÁãÄÊÖãÁÆ°ÁêÜÔºö‰ΩøÁî® Vue 3 Composition API
// Ëº∏ÂÖ•ÁöÑ Instagram URL (Reel Êàñ Story)
const inputUrl = ref('')
// ËºâÂÖ•ÁãÄÊÖãÊ®ôË®ò
const loading = ref(false)
// ÈåØË™§Ë®äÊÅØ
const error = ref('')
// ‰∏ãËºâÁöÑÂΩ±Áâá URL
const videoUrl = ref('')
// Ëß£ÊûêÂá∫ÁöÑ Stories Ê∏ÖÂñÆ
const storiesList = ref([])
// Áï∂ÂâçÊ®°ÂºèÔºö'reel' Reel‰∏ãËºâ„ÄÅ'story' ÂñÆ‰∏ÄStory‰∏ãËºâ„ÄÅ'batch-stories' ÊâπÈáèStories‰∏ãËºâ
const mode = ref('reel')
// ÈÅ∏‰∏≠ÁöÑ Stories
const selectedStories = ref([])
// Ë¶ñÈ†ª‰∏ãËºâÁãÄÊÖã
const downloading = ref(false)
// Ë¶ñÈ†ª‰ø°ÊÅØ
const videoInfo = ref({ duration: 0, size: '' })
// ÂØ¶È©óÊÄßÂäüËÉΩÈÅ∏È†Ö
const useAdvancedStory = ref(false)
const useSnapInstaStyle = ref(false)
const useSnapInsStyle = ref(false)
const useUltraSmartMethod = ref(false)
const useUltimateMethod = ref(false)
const useSnapInsRealMethod = ref(false)
const instagramCookie = ref('')

// Ê®°ÂºèÂàáÊèõÂáΩÊï∏ÔºöÂàáÊèõ‰∏çÂêåÁöÑ‰∏ãËºâÊ®°Âºè
const switchMode = (newMode) => {
  mode.value = newMode
  // Ê∏ÖÈô§‰πãÂâçÁöÑÁãÄÊÖã
  error.value = ''
  videoUrl.value = ''
  storiesList.value = []
  inputUrl.value = ''
  downloading.value = false
  videoInfo.value = { duration: 0, size: '' }
  useAdvancedStory.value = false
  useSnapInstaStyle.value = false
  useSnapInsStyle.value = false
  useUltraSmartMethod.value = false
  useUltimateMethod.value = false
  useSnapInsRealMethod.value = false
  instagramCookie.value = ''
}

// Ê†πÊìöÊ®°ÂºèÁç≤ÂèñËº∏ÂÖ•Ê°Ü placeholder ÊñáÂ≠ó
const getPlaceholderText = () => {
  switch (mode.value) {
    case 'reel':
      return 'https://www.instagram.com/reel/ABC123/ Êàñ https://www.instagram.com/p/ABC123/'
    case 'story':
      return 'https://www.instagram.com/stories/username/story_id/'
    case 'batch-stories':
      return 'https://www.instagram.com/stories/username/'
    default:
      return ''
  }
}

// Ê†πÊìöÊ®°ÂºèÁç≤ÂèñÊåâÈàïÊñáÂ≠ó
const getButtonText = () => {
  switch (mode.value) {
    case 'reel':
      return '‰∏ãËºâ Reel'
    case 'story':
      return '‰∏ãËºâ Story'
    case 'batch-stories':
      return 'Ëß£ÊûêÊâÄÊúâ Stories'
    default:
      return '‰∏ãËºâ'
  }
}

// Ê†πÊìöÊ®°ÂºèÁç≤ÂèñËºâÂÖ•‰∏≠ÊñáÂ≠ó
const getLoadingText = () => {
  switch (mode.value) {
    case 'reel':
      return '‰∏ãËºâ‰∏≠...'
    case 'story':
      return '‰∏ãËºâ‰∏≠...'
    case 'batch-stories':
      return 'Ëß£Êûê‰∏≠...'
    default:
      return 'ËôïÁêÜ‰∏≠...'
  }
}

// Áµ±‰∏ÄÁöÑÊìç‰ΩúËôïÁêÜÂáΩÊï∏
const handleAction = () => {
  switch (mode.value) {
    case 'reel':
      return downloadReel()
    case 'story':
      return downloadStory()
    case 'batch-stories':
      return parseStories()
  }
}

// Reel ‰∏ãËºâÂáΩÊï∏Ôºö‰∏ãËºâ Instagram Reel
const downloadReel = async () => {
  // È©óË≠âËº∏ÂÖ•ÔºöÁ¢∫‰øùÁî®Êà∂Êèê‰æõ‰∫Ü URL
  if (!inputUrl.value) {
    error.value = 'Ë´ãËº∏ÂÖ• Instagram Reel ÈÄ£Áµê'
    return
  }

  // ÈáçÁΩÆÁãÄÊÖãÔºöÈñãÂßãÊñ∞ÁöÑ‰∏ãËºâË´ãÊ±Ç
  loading.value = true
  error.value = ''
  videoUrl.value = ''

  try {
    // ÁôºÈÄÅ API Ë´ãÊ±ÇÔºöÂëºÂè´ÂæåÁ´Ø Reel ‰∏ãËºâÊúçÂãô
    const response = await $fetch('/api/download-reel', {
      method: 'POST',
      body: {
        url: inputUrl.value
      }
    })

    // ËôïÁêÜÈüøÊáâÔºöÊ†πÊìöÁµêÊûúÊõ¥Êñ∞ UI
    if (response.success && response.videoUrl) {
      // ÊàêÂäüÔºöË®≠ÁΩÆÂΩ±Áâá URL ‰æõ‰∏ãËºâ
      videoUrl.value = response.videoUrl
    } else {
      // Â§±ÊïóÔºöÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
      error.value = response.error || 'ÁÑ°Ê≥ï‰∏ãËºâ ReelÔºåË´ãÁ¢∫Ë™çÈÄ£ÁµêÊòØÂê¶Ê≠£Á¢∫'
    }
  } catch (err) {
    // ÊçïÁç≤Á∂≤Ë∑ØÊàñÂÖ∂‰ªñÈåØË™§
    error.value = 'ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶'
    console.error(err)
  } finally {
    // ÁÑ°Ë´ñÊàêÂäüÊàñÂ§±ÊïóÔºåÈÉΩË¶ÅÁµêÊùüËºâÂÖ•ÁãÄÊÖã
    loading.value = false
  }
}

// ÊâπÈáè Stories Ëß£ÊûêÂáΩÊï∏ÔºöËß£Êûê Instagram Stories ‰∏¶ÂàóÂá∫ÊâÄÊúâ Stories
const parseStories = async () => {
  // È©óË≠âËº∏ÂÖ•ÔºöÁ¢∫‰øùÁî®Êà∂Êèê‰æõ‰∫Ü Stories URL
  if (!inputUrl.value) {
    error.value = 'Ë´ãËº∏ÂÖ• Instagram Stories ÈÄ£Áµê'
    return
  }

  // ÈáçÁΩÆÁãÄÊÖãÔºöÈñãÂßãÊñ∞ÁöÑËß£ÊûêË´ãÊ±Ç
  loading.value = true
  error.value = ''
  videoUrl.value = ''
  storiesList.value = []

  try {
    // ÁôºÈÄÅ API Ë´ãÊ±ÇÔºöÂëºÂè´ÂæåÁ´Ø Stories Ëß£ÊûêÊúçÂãô
    const response = await $fetch('/api/parse-stories', {
      method: 'POST',
      body: {
        storiesUrl: inputUrl.value
      }
    })

    // ËôïÁêÜÈüøÊáâÔºöÊ†πÊìöÁµêÊûúÊõ¥Êñ∞ UI
    if (response.success && response.stories) {
      // ÊàêÂäüÔºöË®≠ÁΩÆ Stories Ê∏ÖÂñÆ
      storiesList.value = response.stories
    } else {
      // Â§±ÊïóÔºöÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
      error.value = response.error || 'ÁÑ°Ê≥ïËß£Êûê StoriesÔºåË´ãÁ¢∫Ë™çÈÄ£ÁµêÊòØÂê¶Ê≠£Á¢∫'
    }
  } catch (err) {
    // ÊçïÁç≤Á∂≤Ë∑ØÊàñÂÖ∂‰ªñÈåØË™§
    error.value = 'ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶'
    console.error(err)
  } finally {
    // ÁÑ°Ë´ñÊàêÂäüÊàñÂ§±ÊïóÔºåÈÉΩË¶ÅÁµêÊùüËºâÂÖ•ÁãÄÊÖã
    loading.value = false
  }
}

// ‰∏ãËºâÁâπÂÆö Story ÂáΩÊï∏ÔºöÁï∂Áî®Êà∂ÈªûÊìä Stories Ê∏ÖÂñÆ‰∏≠ÁöÑÊüêÂÄã Story ÊôÇÂëºÂè´
const downloadSpecificStory = async (storyUrl) => {
  // Êö´Â≠òÁï∂ÂâçËº∏ÂÖ•‰∏¶ÂàáÊèõÂà∞‰∏ãËºâË©≤ÁâπÂÆö Story
  const originalUrl = inputUrl.value
  inputUrl.value = storyUrl
  
  try {
    await downloadStory()
  } finally {
    // ÊÅ¢Âæ©ÂéüÂßãËº∏ÂÖ•
    inputUrl.value = originalUrl
  }
}

// ‰∏ªË¶Å‰∏ãËºâÂáΩÊï∏ÔºöËôïÁêÜÁî®Êà∂ÈªûÊìä‰∏ãËºâÊåâÈàïÁöÑÈÇèËºØ
const downloadStory = async () => {
  // È©óË≠âËº∏ÂÖ•ÔºöÁ¢∫‰øùÁî®Êà∂Êèê‰æõ‰∫Ü URL
  if (!inputUrl.value) {
    error.value = 'Ë´ãËº∏ÂÖ• Instagram Stories ÈÄ£Áµê'
    return
  }

  // ÈáçÁΩÆÁãÄÊÖãÔºöÈñãÂßãÊñ∞ÁöÑ‰∏ãËºâË´ãÊ±Ç
  loading.value = true
  error.value = ''
  videoUrl.value = ''

  try {
    // Ê†πÊìöÈÅ∏ÊìáÁöÑÊñπÊ≥ïÊ±∫ÂÆö API Á´ØÈªû
    let apiEndpoint = '/api/download-story'
    
    if (useSnapInsRealMethod.value) {
      apiEndpoint = '/api/download-story-snapins-real'
    } else if (useUltimateMethod.value) {
      apiEndpoint = '/api/download-story-ultimate'
    } else if (useUltraSmartMethod.value) {
      apiEndpoint = '/api/download-story-ultra-smart'
    } else if (useSnapInsStyle.value) {
      apiEndpoint = '/api/download-story-snapins-style'
    } else if (useSnapInstaStyle.value) {
      apiEndpoint = '/api/download-story-snapinsta-style'
    } else if (useAdvancedStory.value) {
      apiEndpoint = '/api/download-story-advanced'
    }
    
    const requestBody = {
      url: inputUrl.value
    }
    
    // Â¶ÇÊûú‰ΩøÁî®ÈÄ≤ÈöéÂäüËÉΩ‰∏îÊúâÊèê‰æõ CookieÔºåÂâáÂä†ÂÖ•Ë´ãÊ±Ç
    if (useAdvancedStory.value && instagramCookie.value.trim()) {
      requestBody.cookie = instagramCookie.value.trim()
    }
    
    console.log(`[DEBUG] ‰ΩøÁî® API Á´ØÈªû: ${apiEndpoint}`)
    console.log(`[DEBUG] üéØ ÁúüÂØ¶ SnapIns.ai ÂÖãÈöÜ: ${useSnapInsRealMethod.value}`)
    console.log(`[DEBUG] üèÜ ÁµÇÊ•µÊåëÊà∞ÊñπÊ≥ï: ${useUltimateMethod.value}`)
    console.log(`[DEBUG] üöÄ Ë∂ÖÁ¥öÊô∫ËÉΩÊñπÊ≥ï: ${useUltraSmartMethod.value}`)
    console.log(`[DEBUG] SnapIns.ai È¢®Ê†º: ${useSnapInsStyle.value}`)
    console.log(`[DEBUG] SnapInsta È¢®Ê†º: ${useSnapInstaStyle.value}`)
    console.log(`[DEBUG] ÈÄ≤ÈöéÊñπÊ≥ï: ${useAdvancedStory.value}`)
    
    // ÁôºÈÄÅ API Ë´ãÊ±ÇÔºöÂëºÂè´ÂæåÁ´Ø Stories ‰∏ãËºâÊúçÂãô
    const response = await $fetch(apiEndpoint, {
      method: 'POST',
      body: requestBody
    })

    // ËôïÁêÜÈüøÊáâÔºöÊ†πÊìöÁµêÊûúÊõ¥Êñ∞ UI
    if (response.success && response.videoUrl) {
      // ÊàêÂäüÔºöË®≠ÁΩÆÂΩ±Áâá URL ‰æõ‰∏ãËºâ
      videoUrl.value = response.videoUrl
    } else {
      // Â§±ÊïóÔºöÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
      error.value = response.error || 'ÁÑ°Ê≥ï‰∏ãËºâ StoryÔºåË´ãÁ¢∫Ë™çÈÄ£ÁµêÊòØÂê¶Ê≠£Á¢∫'
    }
  } catch (err) {
    // ÊçïÁç≤Á∂≤Ë∑ØÊàñÂÖ∂‰ªñÈåØË™§
    error.value = 'ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶'
    console.error(err)
  } finally {
    // ÁÑ°Ë´ñÊàêÂäüÊàñÂ§±ÊïóÔºåÈÉΩË¶ÅÁµêÊùüËºâÂÖ•ÁãÄÊÖã
    loading.value = false
  }
}

// Ë¶ñÈ†ªËºâÂÖ•ÂÆåÊàê‰∫ã‰ª∂
const onVideoLoaded = (event) => {
  const video = event.target
  videoInfo.value.duration = video.duration
  
  // ÂòóË©¶Áç≤ÂèñÊñá‰ª∂Â§ßÂ∞èÔºàÂ¶ÇÊûúÂèØËÉΩÁöÑË©±Ôºâ
  fetch(videoUrl.value, { method: 'HEAD' })
    .then(response => {
      const contentLength = response.headers.get('content-length')
      if (contentLength) {
        const sizeInMB = (parseInt(contentLength) / (1024 * 1024)).toFixed(1)
        videoInfo.value.size = `${sizeInMB} MB`
      }
    })
    .catch(() => {
      // ÂøΩÁï•ÈåØË™§ÔºåÂ§ßÂ∞è‰ø°ÊÅØ‰∏çÊòØÂøÖÈúÄÁöÑ
    })
}

// Ë¶ñÈ†ªËºâÂÖ•ÈåØË™§‰∫ã‰ª∂
const onVideoError = () => {
  error.value = 'Ë¶ñÈ†ªËºâÂÖ•Â§±ÊïóÔºåË´ãÊ™¢Êü•ÈÄ£ÁµêÊòØÂê¶ÊúâÊïà'
}

// Ê†ºÂºèÂåñÊôÇÈï∑È°ØÁ§∫
const formatDuration = (seconds) => {
  const mins = Math.floor(seconds / 60)
  const secs = Math.floor(seconds % 60)
  return `${mins}:${secs.toString().padStart(2, '0')}`
}

/**
 * Áõ¥Êé•‰∏ãËºâË¶ñÈ†ªÊñá‰ª∂ÔºàÂÉè SnapInsta ‰∏ÄÊ®£ÁöÑÈ†êË¶Ω‰∏ãËºâÂäüËÉΩÔºâ
 * 
 * üé¨ È†êË¶Ω‰∏ãËºâÂäüËÉΩËß£Ë™™ÔºàÁ∞°ÂñÆÂà∞ÂçÅÊ≠≤Â≠©Á´•ÈÉΩÊáÇÔºâÔºö
 * 
 * ## Â∞±ÂÉèÁúãÈõªÂΩ±È†êÂëäÁâá‰∏ÄÊ®£ÔºÅ
 * 
 * ÈÄôÂÄãÂäüËÉΩÂÅö‰∫Ü‰∏â‰ª∂‰∫ãÔºö
 * 1. Áç≤ÂèñË¶ñÈ†ªÈÄ£Áµê - Â∞±ÂÉèÂïèÊúãÂèãÔºö„ÄåheyÔºåInstagram ‰∏äÈÄôÂÄãÂΩ±ÁâáÁöÑÁúüÂØ¶Á∂≤ÂùÄÊòØ‰ªÄÈ∫ºÔºü„Äç
 * 2. Âú®È†ÅÈù¢È°ØÁ§∫È†êË¶Ω - Â∞±ÂÉèÂú®‰Ω†ÁöÑÈõªËÖ¶‰∏äÊîæ‰∏ÄÂÄãÂ∞èÈõªË¶ñ
 * 3. Áõ¥Êé•‰∏ãËºâÂà∞ÈõªËÖ¶ - Â∞±ÂÉèÁî®Âê∏ÁÆ°ÊääÈ£≤ÊñôÂê∏Âà∞‰Ω†ÁöÑÊùØÂ≠êË£°
 * 
 * ## ÊäÄË°ìÂéüÁêÜÔºàÁ∞°ÂñÆÁâàÔºâÔºö
 * 
 * Ê≠•È©ü 1: Áî® fetch() Áï∂‰Ωú„ÄåÁ∂≤Ë∑ØÂê∏ÁÆ°„ÄçÂê∏ÂèñÂΩ±Áâá
 * Ê≠•È©ü 2: Áî® blob ÊääË≥áÊñôËÆäÊàêÊ™îÊ°àÔºàblob Â∞±ÂÉè‰∏ÄÂÄãË≥áÊñôÁõíÂ≠êÔºâ
 * Ê≠•È©ü 3: ÂâµÈÄ†‰∏ÄÂÄãÈö±ÂΩ¢‰∏ãËºâÊåâÈàï‰∏¶Ëá™ÂãïÈªûÊìäÂÆÉ
 * 
 * ## Ë∑ü‰ª•ÂâçÁöÑÂ∑ÆÂà•Ôºö
 * 
 * ‰ª•ÂâçÔºàÈñãÊñ∞ÂàÜÈ†ÅÔºâÔºöÈªû‰∏ãËºâ ‚Üí ÈñãÊñ∞ÂàÜÈ†Å ‚Üí Âè≥ÈçµÂè¶Â≠òÂΩ±Áâá
 * ÁèæÂú®ÔºàÂÉè SnapInstaÔºâÔºöÈªû‰∏ãËºâ ‚Üí Âú®Âêå‰∏ÄÈ†ÅÁúãÈ†êË¶Ω ‚Üí Èªû‰∏ÄÂÄãÊåâÈàïÂ∞±‰∏ãËºâÂÆåÊàê
 * 
 * Â∞±ÂÉè‰ª•ÂâçË¶ÅËµ∞Âà∞Âà•ÁöÑÊàøÈñìÁúãÈõªË¶ñÔºåÁèæÂú®ÈõªË¶ñÁõ¥Êé•Êê¨Âà∞‰Ω†Èù¢ÂâçÔºå
 * ÈÇÑÈôÑ‰∏ÄÂÄã„Äå‰∏ÄÈçµÈåÑÂΩ±„ÄçÊåâÈàïÔºÅ
 * 
 * ## ÈóúÈçµÊäÄË°ìÔºö
 * - <video> Ê®ôÁ±§ = Á∂≤È†ÅÂ∞èÈõªË¶ñ
 * - fetch() = Á∂≤Ë∑ØÂê∏ÁÆ°
 * - blob = ÊääË≥áÊñôËÆäÊàêÊ™îÊ°àÁöÑÈ≠îÊ≥ï
 * - createElement('a') = ÂâµÈÄ†Èö±ÂΩ¢‰∏ãËºâÊåâÈàï
 */
const downloadVideo = async () => {
  if (!videoUrl.value) return
  
  downloading.value = true
  
  try {
    // Ê≠•È©ü 1ÔºöÁî®„ÄåÁ∂≤Ë∑ØÂê∏ÁÆ°„ÄçÔºàfetchÔºâÂê∏ÂèñÂΩ±Áâá
    const response = await fetch(videoUrl.value)
    // Ê≠•È©ü 2ÔºöÊääÂΩ±ÁâáËÆäÊàê„ÄåÊ™îÊ°àÁõíÂ≠ê„ÄçÔºàblobÔºâ
    const blob = await response.blob()
    
    // Ê≠•È©ü 3ÔºöÂâµÂª∫‰∏ÄÂÄãËá®ÊôÇÁöÑ‰∏ãËºâÂú∞ÂùÄ
    const url = window.URL.createObjectURL(blob)
    // Ê≠•È©ü 4ÔºöÂâµÈÄ†„ÄåÈö±ÂΩ¢‰∏ãËºâÊåâÈàï„Äç
    const link = document.createElement('a')
    link.href = url
    
    // Ë®≠ÁΩÆÊñá‰ª∂ÂêçÔºàÂæû Instagram URL ‰∏≠ÊèêÂèñ IDÔºâ
    const urlParts = inputUrl.value.match(/\/(?:reel|p|stories)\/([^/]+)/)
    const fileName = urlParts ? `instagram_${urlParts[1]}.mp4` : 'instagram_video.mp4'
    link.download = fileName
    
    // Ê≠•È©ü 5ÔºöËá™ÂãïÈªûÊìäÈö±ÂΩ¢ÊåâÈàïÔºåËß∏Áôº‰∏ãËºâ
    document.body.appendChild(link)
    link.click() // „ÄåÂíîÂöì„ÄçÔºÅ‰∏ãËºâÈñãÂßã‰∫ÜÔºÅ
    
    // Ê≠•È©ü 6ÔºöÊ∏ÖÁêÜÔºàÊääÈö±ÂΩ¢ÊåâÈàïÂíåËá®ÊôÇÂú∞ÂùÄÂà™ÊéâÔºâ
    document.body.removeChild(link)
    window.URL.revokeObjectURL(url)
    
  } catch (error) {
    console.error('‰∏ãËºâÂ§±Êïó:', error)
    error.value = '‰∏ãËºâÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶'
  } finally {
    downloading.value = false
  }
}
</script>

<style scoped>
/* Ëá™ÂÆöÁæ©ÂãïÁï´ÔºöÊóãËΩâËºâÂÖ•ÊåáÁ§∫Âô® */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ÊáâÁî®ÊóãËΩâÂãïÁï´ÁöÑÈ°ûÂà• */
.animate-spin {
  animation: spin 1s linear infinite;
}

/* ÊñáÂ≠óÊà™Êñ∑È°ûÂà• */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>